/*
 ### jQuery XML to JSON Plugin v1.0 - 2008-07-01 ###
 * http://www.fyneworks.com/ - diego@fyneworks.com
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 ###
 Website: http://www.fyneworks.com/jquery/xml-to-json/
*//*
 # INSPIRED BY: http://www.terracoder.com/
           AND: http://www.thomasfrank.se/xml_to_json.html
											AND: http://www.kawa.net/works/js/xml/objtree-e.html
*//*
 This simple script converts XML (document of code) into a JSON object. It is the combination of 2
 'xml to json' great parsers (see below) which allows for both 'simple' and 'extended' parsing modes.
*/
/* The file's been modified by Yossi Kolesnicov from Conduit on 20/3/2011, added an options object, for rename and parser functions */
window.jQuery&&function(i){i.extend({xml2json:function(b,l,h){function k(c,p){if(!c)return null;var d="",a=null;m(c.localName||c.nodeName);c.childNodes&&c.childNodes.length>0&&i.each(c.childNodes,function(q,g){var e=g.nodeType,f=m(g.localName||g.nodeName),o=g.text||g.nodeValue||"";if(e!=8)if(e==3||e==4||!f)o.match(/^\s+$/)||(d+=o.replace(/^\s+/,"").replace(/\s+$/,""));else{a=a||{};if(a[f]){a[f].length||(a[f]=n(a[f]));a[f][a[f].length]=k(g,true);a[f].length=a[f].length}else a[f]=h.parser?h.parser(k(g)): k(g)}});if(c.attributes)if(c.attributes.length>0){a=a||{};i.each(c.attributes,function(q,g){var e=m(g.name),f=g.value;if(a[e]){a[e].length||(a[e]=n(a[e]));a[e][a[e].length]=f;a[e].length=a[e].length}else a[e]=f})}if(a){a=i.extend(d!=""?new String(d):{},a||{});if(d=a.text?(typeof a.text=="object"?a.text:[a.text||""]).concat([d]):d)a.text=d;d=""}var j=a||d;if(l){if(d)j={};if(d=j.text||d||"")j.text=d;p||(j=n(j))}return j}if(!b)return{};h||(h={});var m=h.rename||function(c){return String(c||"").replace(/-/g, "_")},n=function(c){c.length||(c=[c]);c.length=c.length;return c};if(typeof b=="string")b=i.text2xml(b);if(b.nodeType){if(b.nodeType==3||b.nodeType==4)return b.nodeValue;b=b.nodeType==9?b.documentElement:b;var r=k(b,true);b=b=null;return r}},text2xml:function(b){var l;try{var h=i.browser.msie?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser;h.async=false}catch(k){throw Error("XML Parser could not be instantiated");}try{l=i.browser.msie?h.loadXML(b)?h:false:h.parseFromString(b,"text/xml")}catch(m){throw Error("Error parsing XML string"); }return l}})}(jQuery);